var Modul_widget=function(){function e(){var g=this;ftui.log(1,"init widget: name="+this.widgetname+" area="+this.area);this.elements=$('div[data-type="'+this.widgetname+'"]',this.area);this.elements.each(function(h){g.init_attr($(this));g.init_ui($(this))})}function c(h){var g=h.data("readonly");return(g==="true"||g==="1"||g==="on"||g===1)}function a(g){}function d(g){g.text(this.widgetname)}function b(j,p){var m=j.data(p);if(m&&$.isArray(m)||m&&!m.match(/^[#\.\[].*/)){var h=j.data("device");if(!$.isArray(m)){m=new Array(m)}for(var n=0,o=m.length;n<o;n++){var l=m[n];if(l.match(/:/)){var k=l.split(":");h=k[0];l=k[1]}if(isValid(h)&&isValid(l)){var g=(l==="STATE")?h:[h,l].join("-");this.subscriptions[g]={};this.subscriptions[g].device=h;this.subscriptions[g].reading=l}}}}function f(g,h){ftui.log(1,"warning: "+this.widgetname+" does not implement update function")}return{widgetname:"widget",area:"",isReadOnly:c,init:e,init_attr:a,init_ui:d,update:f,addReading:b,subscriptions:{}}};var plugins={modules:[],addModule:function(a){this.modules.push(a)},removeArea:function(b){for(var a=this.modules.length-1;a>=0;a-=1){if(this.modules[a].area===b){this.modules.splice(a,1)}}},updateParameters:function(){ftui.subscriptions={};ftui.subscriptionTs={};ftui.devs=[];for(var c=this.modules.length-1;c>=0;c-=1){var b=this.modules[c];for(var a in b.subscriptions){ftui.subscriptions[a]=b.subscriptions[a];ftui.subscriptionTs[a+"-ts"]=b.subscriptions[a];var e=ftui.subscriptions[a].device;if(ftui.devs.indexOf(e)<0){ftui.devs.push(e)}}}ftui.states.lastShortpoll=0},load:function(a,b){ftui.log(1,"Load widget : "+a);return ftui.loadPlugin(a,b)},update:function(a,b){$.each(this.modules,function(c,d){d.update(a,b)});ftui.log(1,'update done for "'+a+":"+b+'"')}};var ftui={version:"2.2.3",config:{DEBUG:false,DEMO:false,dir:"",filename:"",fhem_dir:"",debuglevel:0,doLongPoll:false,shortpollInterval:0,styleCollection:{},stdColors:["green","orange","red","ligthblue","blue","gray","white","mint"]},poll:{currLine:0,xhr:null,longPollRequest:null,shortPollTimer:null,longPollTimer:null,timestamp:"01.01.1970"},states:{lastSetOnline:0,lastShortpoll:0,longPollRestart:false},deviceStates:{},paramIdMap:{},timestampMap:{},subscriptions:{},subscriptionTs:{},gridster:{instances:{},instance:null,wx:0,wy:0,wm:5,mincols:0},init:function(){ftui.paramIdMap={};ftui.timestampMap={};ftui.loadStyleSchema();ftui.gridster.wx=parseInt($("meta[name='widget_base_width']").attr("content")||74);ftui.gridster.wy=parseInt($("meta[name='widget_base_height']").attr("content")||71);ftui.gridster.mincols=parseInt($("meta[name='widget_min_cols']").attr("content")||$(window).width()/ftui.gridster.wx);if($("meta[name='widget_margin']").attr("content")){ftui.gridster.wm=parseInt($("meta[name='widget_margin']").attr("content"))}ftui.config.doLongPoll=($("meta[name='longpoll']").attr("content")=="1");ftui.config.DEMO=($("meta[name='demo']").attr("content")=="1");ftui.config.debuglevel=$("meta[name='debug']").attr("content")||0;ftui.config.DEBUG=(ftui.config.debuglevel>0);ftui.config.TOAST=$("meta[name='toast']").attr("content")||5;ftui.config.shortpollInterval=$("meta[name='shortpoll-only-interval']").attr("content")||30;ftui.config.dir=$('script[src*="fhem-tablet-ui"]').attr("src");var d=ftui.config.dir.split("/").pop();ftui.config.dir=ftui.config.dir.replace("/"+d,"");ftui.log(1,"Plugin dir: "+ftui.config.dir);var c=window.location.pathname;ftui.config.filename=c.substring(c.lastIndexOf("/")+1);ftui.log(1,"Filename: "+ftui.config.filename);ftui.config.fhem_dir=$("meta[name='fhemweb_url']").attr("content")||"/fhem/";ftui.log(1,"FHEM dir: "+ftui.config.fhem_dir);try{localStorage.setItem("ftui",ftui.version);localStorage.removeItem("ftui")}catch(f){ftui.toast("You are in Privacy Mode<br>Please deactivate Privacy Mode and then reload the page.","error")}$("<div id='shade' />").prependTo("body").hide();var a=getAndroidVersion();var g=(a&&parseFloat(a)<4.3);var b=(g)?"touchstart":"touchstart mousedown";$("#shade").on(b,function(h){$(document).trigger("shadeClicked")});ftui.readStatesLocal();ftui.initPage();$(document).on("initWidgetsDone",function(){ftui.startShortPollInterval(500)});$(document).one("updateDone",function(){ftui.initLongpoll()});$("*:not(select)").focus(function(){$(this).blur()});if(ftui.config.debuglevel>0){setInterval(function(){ftui.healthCheck()},60000)}},initGridster:function(b){if($.fn.gridster){if(ftui.gridster.instances[b]){ftui.gridster.instances[b].destroy()}ftui.gridster.instances[b]=$(".gridster > ul",b).gridster({widget_base_dimensions:[ftui.gridster.wx,ftui.gridster.wy],widget_margins:[ftui.gridster.wm,ftui.gridster.wm],draggable:{handle:".gridster li > header"},min_cols:parseInt(ftui.gridster.mincols)}).data("gridster");if(ftui.gridster.instances[b]){if($("meta[name='gridster_disable']").attr("content")=="1"){ftui.gridster.instances[b].disable()}if($("meta[name='gridster_starthidden']").attr("content")=="1"){$(".gridster").hide()}}var a=$(".gridster > ul > li:has(* .gridster)");if(a.length>0){a.css({"background-color":"transparent",margin:"-"+ftui.gridster.wm+"px",width:a.parent().width()-a.position().left,height:"100%"})}$(".gridster > ul > li:has(.center)").addClass("vbox");$(".gridster > ul > li:has(.vbox)").addClass("vbox")}},initPage:function(b){b=(isValid(b))?b:"";console.time("initPage");ftui.log(2,"initPage - area="+b);ftui.startShortPollInterval();ftui.initGridster(b);var a=$("[data-template]",b).length;ftui.log(2,"count of templates:",a);if(a>0){$("[data-template]",b).each(function(c){var d=$(this);$.get(d.data("template"),{},function(g){var e=d.data("parameter");for(var f in e){g=g.replace(new RegExp(f,"g"),e[f])}d.html(g);if(c===a-1){ftui.initWidgets(b)}})})}else{ftui.initWidgets(b)}},initWidgets:function(c){c=(isValid(c))?c:"";var a=[];ftui.log(3,plugins);plugins.removeArea(c);ftui.log(3,plugins);ftui.log(2,"initWidgets - area="+c);$("div[data-type]",c).each(function(d){var e=$(this).data("type");if(a.indexOf(e)<0){a.push(e)}});var b=$.map(a,function(e,d){return plugins.load(e,c)});$.when.apply(this,b).then(function(){plugins.updateParameters();ftui.log(1,"initWidgets - Done");console.timeEnd("initPage");$(document).trigger("initWidgetsDone",[c])})},initLongpoll:function(){if(ftui.config.doLongPoll){var a=$("meta[name='longpoll-delay']").attr("content");a=($.isNumeric(a))?a*1000:100;ftui.startLongPollInterval(a)}},startShortPollInterval:function(a){ftui.log(1,"start shortpoll in (ms):"+(a||ftui.config.shortpollInterval*1000));clearInterval(ftui.shortPollTimer);ftui.shortPollTimer=setTimeout(function(){ftui.shortPoll();ftui.startShortPollInterval()},(a||ftui.config.shortpollInterval*1000))},startLongPollInterval:function(a){if(ftui.config.DEBUG&&a>999){ftui.toast("Start Longpoll in "+a/1000+"s")}clearInterval(ftui.longPollTimer);ftui.longPollTimer=setTimeout(function(){ftui.longPoll()},a);ftui.config.shortpollInterval=$("meta[name='shortpoll-interval']").attr("content")||15*60},shortPoll:function(){var d=new Date().getTime()/1000;if((d-ftui.states.lastShortpoll)<ftui.config.shortpollInterval){return}ftui.log(1,"start shortpoll");var b=new Date();for(var c in ftui.deviceStates){var e=ftui.deviceStates[c];for(reading in e){e[reading].valid=false}}console.time("get jsonlist2");var a=$.map(ftui.devs,$.trim).join();$.getJSON(ftui.config.fhem_dir,{cmd:"jsonlist2 "+a,XHR:1,timeout:60000}).done(function(k){console.timeEnd("get jsonlist2");console.time("read jsonlist2");ftui.log(3,"fhemJSON: 0="+Object.keys(k)[0]+" 1="+Object.keys(k)[1]);function l(p,v){for(var s in v){var w=false;var i=(s==="STATE")?p:[p,s].join("-");var u=v[s];if(typeof u!=="object"){u={Value:u,Time:""}}if(ftui.subscriptions[i]){var t=ftui.getDeviceParameter(p,s);w=(!t||t.val!==u.Value||t.date!==u.Time)}var r=ftui.deviceStates[p]||{};var q=r[s]||{};q.date=u.Time;q.val=u.Value;q.valid=true;r[s]=q;ftui.deviceStates[p]=r;ftui.paramIdMap[i]={};ftui.paramIdMap[i].device=p;ftui.paramIdMap[i].reading=s;ftui.timestampMap[i+"-ts"]={};ftui.timestampMap[i+"-ts"].device=p;ftui.timestampMap[i+"-ts"].reading=s;if(w){plugins.update(p,s)}}}var m=k.Results.length;ftui.log(2,"shortpoll: fhemJSON.Results.length="+m);var h=k.Results;for(var j=0;j<m;j++){var n=h[j];var g=n.Name;if(g.indexOf("FHEMWEB")!==0&&g.indexOf("WEB_")!==0){l(g,n.Readings);l(g,n.Internals);l(g,n.Attributes)}}var f=diffSeconds(b,new Date());if(ftui.config.DEBUG){var o=Object.keys(ftui.paramIdMap).length;ftui.toast("Full refresh done in "+f+"s for "+o+" parameter(s)")}ftui.log(1,"shortPoll - Done");ftui.states.lastShortpoll=d;ftui.saveStatesLocal();ftui.onUpdateDone();console.timeEnd("read jsonlist2")}).fail(function(h,i,f){var g=i+", "+f;ftui.log(1,"shortPoll request failed: "+g);ftui.toast("<u>ShortPoll Request Failed, will retry in 3s</u><br>"+g,"error");ftui.states.lastSetOnline=0;ftui.states.lastShortpoll=0;ftui.startShortPollInterval(3000)})},longPoll:function(){if(ftui.config.DEMO){console.log("DEMO-Mode: no longpoll");return}if(ftui.xhr){console.log("valid ftui.xhr found");return}if(ftui.longPollRequest){console.log("valid ftui.longPollRequest found");return}ftui.poll.currLine=0;if(ftui.config.DEBUG){if(ftui.states.longPollRestart){ftui.toast("Longpoll re-started")}else{ftui.toast("Longpoll started")}}ftui.log(1,(ftui.states.longPollRestart)?"Longpoll re-started":"Longpoll started");ftui.states.longPollRestart=false;var a=$.map(ftui.devs,$.trim).join();ftui.longPollRequest=$.ajax({url:ftui.config.fhem_dir,cache:false,async:true,data:{XHR:1,inform:"type=status;filter="+a+";fmt=JSON"},xhr:function(){ftui.xhr=new window.XMLHttpRequest();ftui.xhr.addEventListener("readystatechange",function(j){var d=j.target.responseText;if(j.target.readyState==4){return}if(j.target.readyState==3){var n=d.split(/\n/);n.pop();for(var f=ftui.poll.currLine,g=n.length;f<g;f++){ftui.log(5,n[f]);if(isValid(n[f])){try{var h=JSON.parse(n[f]);var c=null;var b=null;var m=(h[1]!==h[2]);ftui.log(4,h);var l=ftui.paramIdMap[h[0]];var k=ftui.timestampMap[h[0]];if(l){if(m){l.reading="STATE"}c=ftui.deviceStates[l.device]||{};b=c[l.reading]||{};b.val=h[1];b.valid=true;c[l.reading]=b;ftui.deviceStates[l.device]=c;if(m&&ftui.subscriptions[h[0]]){plugins.update(l.device,l.reading)}}if(k&&!m){c=ftui.deviceStates[k.device]||{};b=c[k.reading]||{};b.date=h[1];c[k.reading]=b;ftui.poll.timestamp=b.date;ftui.deviceStates[k.device]=c;if(ftui.subscriptionTs[h[0]]){plugins.update(k.device,k.reading)}}}catch(j){ftui.log(1,"Error: (longpoll) "+j)}}}ftui.poll.currLine=n.length;if(ftui.poll.currLine>9999){ftui.states.longPollRestart=true;ftui.longPollRequest.abort()}}},false);return ftui.xhr}}).done(function(b){if(ftui.xhr){ftui.xhr.abort();ftui.xhr=null}ftui.longPollRequest=null;if(ftui.states.longPollRestart){ftui.longPoll()}else{ftui.log(1,"Disconnected from FHEM - poll done - "+b);ftui.restartLongPoll()}}).fail(function(b,d,c){if(ftui.xhr){ftui.xhr.abort();ftui.xhr=null}ftui.longPollRequest=null;if(ftui.states.longPollRestart){ftui.longPoll()}else{ftui.log(1,"Error while longpoll: "+d+": "+c);ftui.restartLongPoll()}})},setFhemStatus:function(a){if(ftui.config.DEMO){console.log("DEMO-Mode: no setFhemStatus");return}ftui.startShortPollInterval();a=a.replace("  "," ");ftui.log(1,"send to FHEM: "+a);$.ajax({async:true,cache:false,url:ftui.config.fhem_dir,data:{cmd:a,XHR:"1"}}).fail(function(b,d,c){ftui.toast("<u>FHEM Command Failed</u><br>"+d+": "+c,"error")}).done(function(b){})},loadStyleSchema:function(){$.each($('link[href$="-ui.css"],link[href$="-ui.min.css"]'),function(e,b){if(!b||!b.sheet||!b.sheet.cssRules){return}var f=b.sheet.cssRules;for(var a in f){if(f[a].style){var h=f[a].style.cssText.split(";");h.pop();var g=f[a].selectorText;var d={};for(var i in h){var c=h[i].toString().split(":");if(c[0].match(/color/)){d[$.trim(c[0])]=$.trim(c[1]).replace("! important","").replace("!important","")}}if(Object.keys(d).length>0){ftui.config.styleCollection[g]=d}}}})},onUpdateDone:function(){$(document).trigger("updateDone");ftui.checkInvalidElements()},checkInvalidElements:function(){$("div.autohide[data-get]").each(function(a){var c=$(this);var b=c.getReading("get").valid;if(b&&b===true){c.removeClass("invalid")}else{c.addClass("invalid")}})},setOnline:function(){var a=new Date().getTime()/1000;if((a-ftui.states.lastSetOnline)>60){if(ftui.config.DEBUG){ftui.toast("Network connected")}ftui.states.lastSetOnline=a;ftui.states.lastShortpoll=0;ftui.startShortPollInterval(1000);if(!ftui.config.doLongPoll){ftui.config.doLongPoll=($("meta[name='longpoll']").attr("content")=="1");if(ftui.config.doLongPoll){ftui.startLongPollInterval(100)}}ftui.log(1,"FTUI is online")}},setOffline:function(){if(ftui.config.DEBUG){ftui.toast("Lost network connection")}ftui.config.doLongPoll=false;clearInterval(ftui.shortPollTimer);clearInterval(ftui.longPollTimer);if(ftui.longPollRequest){ftui.longPollRequest.abort()}ftui.saveStatesLocal();ftui.log(1,"FTUI is offline")},readStatesLocal:function(){if(!ftui.config.DEMO){ftui.deviceStates=JSON.parse(localStorage.getItem("deviceStates"))||{}}else{$.ajax({async:false,url:"/fhem/tablet/data/"+ftui.config.filename.replace(".html",".dat")}).done(function(a){ftui.deviceStates=JSON.parse(a)||{}})}},saveStatesLocal:function(){var a=JSON.stringify(ftui.deviceStates);localStorage.setItem("deviceStates",a);localStorage.setItem("shortPollDuration",ftui.poll.shortPollDuration)},restartLongPoll:function(){ftui.toast("Disconnected from FHEM");if(ftui.config.doLongPoll){ftui.toast("Retry to connect in 10 seconds");setTimeout(function(){ftui.longPoll()},10000)}},getDeviceParameter:function(b,a){if(b&&b.length>0){var c=ftui.deviceStates[b];return(c&&c[a])?c[a]:null}return null},loadPlugin:function(a,b){var c=new $.Deferred();ftui.log(2,"Create widget : "+a);ftui.dynamicload(ftui.config.dir+"/widget_"+a+".js",true).done(function(){var e=[];var d=window["depends_"+a];if($.isFunction(d)){var f=d();if(f){f=($.isArray(f))?f:[f];$.map(f,function(h,g){if(h.indexOf(".js")<0){e.push(ftui.loadPlugin(h))}else{e.push(ftui.dynamicload(ftui.config.dir+"/../"+h,false))}})}}else{ftui.log(2,"function depends_"+a+" not found (maybe ok)")}$.when.apply(this,e).always(function(){var h=(window["Modul_"+a])?new window["Modul_"+a]():new window.Modul_widget();if(h){if(typeof b!=="undefined"){plugins.addModule(h);if(isValid(b)){h.area=b}h.init();for(var g in h.subscriptions){h.update(h.subscriptions[g].device,h.subscriptions[g].reading)}}ftui.log(1,"Loaded plugin: "+a)}else{ftui.log(1,"Failed to create widget: "+a)}c.resolve()})}).fail(function(){ftui.toast("Failed to load plugin : "+a);ftui.log(1,"Failed to load plugin : "+a+'  - add <script src="'+ftui.config.dir+"/widget_"+a+'.js" defer><\/script> do your page, to see more informations about this failure');c.resolve()});return c.promise()},dynamicload:function(d,e){var c=(ftui.config.DEBUG)?false:true;ftui.log(3,"dynamic load file:"+d+" / async:"+e);var b=new $.Deferred();var a=document.createElement("script");a.type="text/javascript";a.async=(e)?true:false;a.src=d;a.onload=function(){ftui.log(3,"dynamic load done:"+d);b.resolve()};document.getElementsByTagName("head")[0].appendChild(a);return b.promise()},healthCheck:function(){var a=new Date();a.setTime(ftui.states.lastShortpoll*1000);console.log("--------- start healthCheck --------------");console.log("now:",new Date());console.log("FTUI version:",ftui.version);console.log("Longpoll:",ftui.config.doLongPoll);console.log("Longpoll objects there:",(isValid(ftui.longPollRequest)&&isValid(ftui.xhr)));console.log("Longpoll curent line:",ftui.poll.currLine);console.log("Longpoll last event before:",ftui.poll.timestamp.toDate().ago());console.log("Shortpoll interval:",ftui.config.shortpollInterval);console.log("Shortpoll last run before:",a.ago());console.log("FHEM dev/par count:",Object.keys(ftui.paramIdMap).length);console.log("FTUI known devices count:",Object.keys(ftui.deviceStates).length);console.log("Page length:",$("html").html().length);console.log("Widgets count:",$("div[data-type]").length);console.log("--------- end healthCheck ---------------")},FS20:{dimmerArray:[0,6,12,18,25,31,37,43,50,56,62,68,75,81,87,93,100],dimmerValue:function(b){var a=indexOfNumeric(this.dimmerArray,b);return(a>-1)?this.dimmerArray[a]:0}},rgbToHsl:function(k){var a=parseInt(k.substring(0,2),16);var i=parseInt(k.substring(2,4),16);var m=parseInt(k.substring(4,6),16);a/=255,i/=255,m/=255;var n=Math.max(a,i,m),e=Math.min(a,i,m);var f,o,c=(n+e)/2;if(n==e){f=o=0}else{var j=n-e;o=c>0.5?j/(2-n-e):j/(n+e);switch(n){case a:f=(i-m)/j+(i<m?6:0);break;case i:f=(m-a)/j+2;break;case m:f=(a-i)/j+4;break}f/=6}return[f,o,c]},hslToRgb:function(j,n,i){var a,k,m;var f=function(b){return("0"+parseInt(b).toString(16)).slice(-2)};if(n==0){a=k=m=i}else{function e(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var c=i<0.5?i*(1+n):i+n-i*n;var d=2*i-c;a=e(d,c,j+1/3);k=e(d,c,j);m=e(d,c,j-1/3)}return[f(Math.round(a*255)),f(Math.round(k*255)),f(Math.round(m*255))].join("")},rgbToHex:function(a){var b=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return(b&&b.length===4)?"#"+("0"+parseInt(b[1],10).toString(16)).slice(-2)+("0"+parseInt(b[2],10).toString(16)).slice(-2)+("0"+parseInt(b[3],10).toString(16)).slice(-2):a},getGradientColor:function(e,h,i){e=this.rgbToHex(e).replace(/^\s*#|\s*$/g,"");h=this.rgbToHex(h).replace(/^\s*#|\s*$/g,"");if(e.length==3){e=e.replace(/(.)/g,"$1$1")}if(h.length==3){h=h.replace(/(.)/g,"$1$1")}var a=parseInt(e.substr(0,2),16),d=parseInt(e.substr(2,2),16),b=parseInt(e.substr(4,2),16);var c=parseInt(h.substr(0,2),16),g=parseInt(h.substr(2,2),16),j=parseInt(h.substr(4,2),16);var k=c-a;var l=g-d;var f=j-b;k=((k*i)+a).toString(16).split(".")[0];l=((l*i)+d).toString(16).split(".")[0];f=((f*i)+b).toString(16).split(".")[0];if(k.length==1){k="0"+k}if(l.length==1){l="0"+l}if(f.length==1){f="0"+f}return"#"+k+l+f},getPart:function(e,g){if($.isNumeric(g)){var h=(e&&isValid(e))?e.toString().split(" "):"";return(h.length>=g&&g>0)?h[g-1]:e}else{if((e&&isValid(e))){var f=e.match(new RegExp("^"+g+"$"))}var b="";if(f){for(var d=1,a=f.length;d<a;d++){b+=f[d]}}return b}},showModal:function(a){if(a){$("#shade").fadeIn()}else{$("#shade").fadeOut()}},precision:function(b){var c=b+"",e=c.indexOf(".")+1;return !e?0:c.length-e},toast:function(c,a){if(ftui.config.TOAST!=0){var b=ftui.config.TOAST;if(ftui.config.TOAST==1){b=false}if(a&&a==="error"){$.toast({heading:"Error",text:c,hideAfter:20000,icon:"error",loader:false,stack:b})}else{$.toast({text:c,loader:false,stack:b})}}},log:function(b,a){if(ftui.config.debuglevel>=b){console.log(a)}}};$(document).on("ready",function(){ftui.init()});$(".menu").on("click",function(){$(".menu").toggleClass("show")});$(window).on("beforeunload",function(){ftui.log(5,"beforeunload");ftui.setOffline()});$(window).on("online offline",function(){ftui.log(5,"online offline");if(navigator.onLine){ftui.setOnline()}else{ftui.setOffline()}});function setFhemStatus(a){console.log("setFhemStatus is a deprecated function: use ftui.setFhemStatus instead");ftui.setFhemStatus(a)}this.getPart=function(a,b){console.log("getPart is a deprecated function: use ftui.getPart instead");return ftui.getPart(a,b)};this.getStyle=function(a,c){var b=ftui.config.styleCollection[a];return(b&&b[c])?b[c]:null};this.getClassColor=function(c){for(var b=0,a=ftui.config.stdColors.length;b<a;b++){if(c.hasClass(ftui.config.stdColors[b])){return getStyle("."+ftui.config.stdColors[b],"color")}}return null};this.getIconId=function(d){if(!d||d==""){return"?"}var b=$('link[href$="font-awesome.min.css"]')[0].sheet.cssRules;for(var a in b){if(b[a].selectorText&&b[a].selectorText.match(new RegExp(d+":"))){var c=b[a].style.content;if(!c){return d}c=c.replace(/"/g,"").replace(/'/g,"");return(/[^\u0000-\u00ff]/.test(c))?c:String.fromCharCode(parseInt(c.replace("\\",""),16))}}};this.isValid=function(a){return(typeof a!=="undefined"&&a!=="undefined"&&typeof a!==typeof notusedvar&&a!==""&&a!==" ")};this.showModal=function(a){console.log("Warning: usage of deprecated function > showModal");ftui.showModal(a)};this.dateFromString=function(d){var a=d.match(/(\d+)-(\d+)-(\d+)[_\s](\d+):(\d+):(\d+).*/);var b=d.match(/(\d\d).(\d\d).(\d\d\d\d)/);var c=new Date().getTimezoneOffset();return(a)?new Date(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6]):(b)?new Date(+b[3],+b[2]-1,+b[1],0,-c,0,0):new Date()};this.diffMinutes=function(c,a){var b=new Date(a-c);return(b/1000/60).toFixed(0)};this.diffSeconds=function(c,a){var b=new Date(a-c);return(b/1000).toFixed(1)};this.durationFromSeconds=function(d){var b=Math.floor(d/3600);var c=Math.floor((d%3600)/60);var a=d%60;ret="";if(b>0){ret+=""+b+":"+(c<10?"0":"")}ret+=""+c+":"+(a<10?"0":"");ret+=""+a;return ret};this.mapColor=function(a){return getStyle("."+a,"color")||a};String.prototype.toDate=function(){return dateFromString(this)};String.prototype.parseJson=function(){return parseJsonFromString(this)};this.parseJsonFromString=function(a){return JSON.parse(a)};this.getAndroidVersion=function(b){b=(b||navigator.userAgent).toLowerCase();var a=b.match(/android\s([0-9\.]*)/);return a?a[1]:false};String.prototype.toMinFromSec=function(){var a=Number(this);var b=(Math.floor(a%60)).toString();var c=(Math.floor(a/=60)).toString();return c+":"+(b[1]?b:"0"+b[0])};Date.prototype.addMinutes=function(a){return new Date(this.getTime()+a*60000)};Date.prototype.ago=function(){var b=new Date();var a=(b-this);var g=a/1000;var h=Math.round(g%60);g/=60;var c=Math.round(g%60);g/=60;var f=Math.round(g%24);g/=24;var j=Math.round(g);var i=navigator.language||navigator.userLanguage;var d=(i.split("-")[0]==="de")?["Tag(e)","Stunde(n)","Minute(n)","Sekunde(n)"]:["day(s)","hour(s)","minute(s)","second(s)"];var e=(j>0)?j+" "+d[0]+" ":"";e+=(f>0)?f+" "+d[1]+" ":"";e+=(c>0)?c+" "+d[2]+" ":"";return e+h+" "+d[3]};Date.prototype.yyyymmdd=function(){var c=this.getFullYear().toString();var b=(this.getMonth()+1).toString();var a=this.getDate().toString();return c+"-"+(b[1]?b:"0"+b[0])+"-"+(a[1]?a:"0"+a[0])};Date.prototype.hhmm=function(){var a=this.getHours().toString();var b=this.getMinutes().toString();return(a[1]?a:"0"+a[0])+":"+(b[1]?b:"0"+b[0])};Date.prototype.hhmmss=function(){var b=this.getHours().toString();var c=this.getMinutes().toString();var a=this.getSeconds().toString();return(b[1]?b:"0"+b[0])+":"+(c[1]?c:"0"+c[0])+":"+(a[1]?a:"0"+a[0])};Date.prototype.ddmm=function(){var b=(this.getMonth()+1).toString();var a=this.getDate().toString();return(a[1]?a:"0"+a[0])+"."+(b[1]?b:"0"+b[0])+"."};Date.prototype.eeee=function(){var c=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var a=navigator.language||navigator.userLanguage;if(a.split("-")[0]==="de"){return c[this.getDay()]}return b[this.getDay()]};Date.prototype.eee=function(){var c=["Son","Mon","Die","Mit","Don","Fre","Sam"];var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var a=navigator.language||navigator.userLanguage;if(a.split("-")[0]==="de"){return c[this.getDay()]}return b[this.getDay()]};Date.prototype.ee=function(){var c=["So","Mo","Di","Mi","Do","Fr","Sa"];var b=["Su","Mo","Tu","We","Th","Fr","Sa"];var a=navigator.language||navigator.userLanguage;if(a.split("-")[0]==="de"){return c[this.getDay()]}return b[this.getDay()]};this.indexOfGeneric=function(d,c){if(!d){return -1}for(var b=0,a=d.length;b<a;b++){if(!$.isNumeric(d[b])){return indexOfRegex(d,c)}}return indexOfNumeric(d,c)};this.indexOfNumeric=function(e,d){var b=-1;for(var c=0,a=e.length;c<a;c++){if(Number(d)>=Number(e[c])){b=c}}return b};this.indexOfRegex=function(g,f){for(var c=0,a=g.length;c<a;c++){try{var b=f.match(new RegExp("^"+g[c]+"$"));if(b){return c}}catch(d){}}return g.indexOf(f)};$.fn.once=function(d,c){return this.each(function(){$(this).off(d).on(d,c)})};$.fn.widgetId=function(){return["ftui",$(this).data("type"),$(this).data("device"),$(this).data("get")].join("_")};$.fn.filterData=function(a,b){return this.filter(function(){return $(this).data(a)==b})};$.fn.filterDeviceReading=function(a,b,c){return this.filter(function(){var d=$(this);var e=d.data(a);return(e===c&&d.data("device")===b)||(e===b+":"+c)||($.inArray(c,e)>-1&&d.data("device")===b)||($.inArray(b+":"+c,e)>-1)})};$.fn.isValidData=function(a){return typeof $(this).data(a)!="undefined"};$.fn.initData=function(a,c){var b=$(this);b.data(a,b.isValidData(a)?b.data(a):c);return b};$.fn.mappedColor=function(a){return getStyle("."+$(this).data(a),"color")||$(this).data(a)};$.fn.isDeviceReading=function(b){var a=$(this).data(b);return a&&!$.isNumeric(a)&&a.match(/:/)};$.fn.isExternData=function(a){var b=$(this).data(a);if(!b){return""}return(b.match(/^[#\.\[].*/))};$.fn.getReading=function(e,a){var d=$(this).data("device"),b=$(this).data(e);if($.isArray(b)){b=b[a]}if(b&&b.match(/:/)){var c=b.split(":");d=c[0];b=c[1]}if(d&&d.length>0){var f=ftui.deviceStates[d];return(f&&f[b])?f[b]:{}}return{}};$.fn.valOfData=function(a){var b=$(this).data(a);if(!isValid(b)){return""}return(b.toString().match(/^[#\.\[].*/))?$(b).data("value"):b};$.fn.transmitCommand=function(){if($(this).hasClass("notransmit")){return}var a=[$(this).valOfData("cmd"),$(this).valOfData("device"),$(this).valOfData("set"),$(this).valOfData("value")].join(" ");ftui.setFhemStatus(a);ftui.toast(a)};